# BeaconTester

## Overview
BeaconTester is a testing framework for validating Beacon applications that run rules generated by the Pulsar compiler. It allows you to:

1. Automatically generate test scenarios from rule definitions
2. Execute test scenarios against a running Beacon instance
3. Generate reports on test results

## Architecture
BeaconTester consists of several components:

- **BeaconTester.Core**: Core libraries for test execution and validation
- **BeaconTester.RuleAnalyzer**: Analyzes rule definitions and generates test scenarios
- **BeaconTester.Runner**: Command-line application for generating and running tests
- **BeaconTester.Templates**: Template tests for common scenarios

## Key Features
- **Automatic Test Generation**: Generates tests based on rule conditions, outputs, and dependencies
- **Redis Integration**: Communicates with Beacon instances via Redis
- **Dependency Analysis**: Automatically determines rule dependencies
- **Temporal Testing**: Handles rules with temporal conditions
- **Expectation Validation**: Validates outputs based on rule conditions

## End-to-End Workflow

### Prerequisites
- Pulsar compiler installed and functional
- Redis server running
- .NET SDK installed

### Step 1: Generate Tests from Rules
```bash
dotnet run --project BeaconTester.Runner -- generate --rules=path/to/rules.yaml --output=test_scenarios.json
```

### Step 2: Compile and Run Beacon
```bash
dotnet run --project Pulsar.Compiler beacon --config=system_config.yaml --rules=path/to/rules.yaml --output=./Beacon
cd ./Beacon/Beacon && dotnet build
cd ./Beacon.Runtime && dotnet run
```

### Step 3: Run Tests Against Beacon
```bash
dotnet run --project BeaconTester.Runner -- run --scenarios=test_scenarios.json --output=test_results.json
```

### Step 4: Generate Report
```bash
dotnet run --project BeaconTester.Runner -- report --results=test_results.json --output=report.html --format=html
```

## Automated End-to-End Testing
The repository includes a script to run the entire workflow from rule compilation to test reporting:

```bash
./Scripts/test-end-to-end.sh
```

## Development Guide

### Building the Project
```bash
dotnet build
```

### Running Tests
```bash
dotnet test
```

### Adding New Test Scenarios
1. Create a new test scenario JSON file
2. Define test inputs and expected outputs
3. Run tests using the `run` command

### Adding New Validators
1. Implement the `IValidator` interface
2. Register your validator in the `ValidationFactory`

## Troubleshooting

### Common Issues
- **Redis Connection Errors**: Ensure Redis is running and accessible
- **Missing Outputs**: Check rule dependencies and ensure all required rules are loaded
- **Temporal Rule Failures**: May need to adjust polling intervals for temporal conditions

### Debugging
- Use the `--monitor` flag with the `run` command to monitor Redis activity
- Check Beacon logs for rule execution details
- Examine test results JSON for detailed failure information
